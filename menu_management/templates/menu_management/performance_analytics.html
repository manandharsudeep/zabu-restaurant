{% extends 'base.html' %}

{% block title %}Performance Analytics - Zabu Restaurant{% endblock %}

{% block extra_css %}
<style>
    .analytics-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 3rem 0;
        margin-bottom: 2rem;
    }
    
    .analytics-card {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
        transition: all 0.3s ease;
        border-left: 4px solid #667eea;
    }
    
    .analytics-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    }
    
    .brand-performance {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 1rem;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
        border-left: 3px solid #667eea;
    }
    
    .brand-name {
        font-weight: bold;
        color: #333;
        font-size: 1.1rem;
    }
    
    .brand-stats {
        display: flex;
        gap: 2rem;
        align-items: center;
    }
    
    .stat-item {
        text-align: center;
    }
    
    .stat-number {
        font-size: 1.5rem;
        font-weight: bold;
        color: #667eea;
    }
    
    .stat-label {
        font-size: 0.8rem;
        color: #666;
    }
    
    .top-items-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
    }
    
    .top-items-table th {
        background: #667eea;
        color: white;
        padding: 0.75rem;
        text-align: left;
        font-weight: 600;
    }
    
    .top-items-table td {
        padding: 0.75rem;
        border-bottom: 1px solid #e9ecef;
    }
    
    .top-items-table tr:hover {
        background: #f8f9fa;
    }
    
    .date-filter {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }
    
    .date-range {
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 0.75rem 2rem;
        font-weight: 600;
        border-radius: 50px;
        transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
        background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        transform: translateY(-2px);
        color: white;
    }
    
    .btn-secondary {
        background: #6c757d;
        border: none;
        color: white;
        padding: 0.75rem 2rem;
        font-weight: 600;
        border-radius: 50px;
        transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
        color: white;
    }
    
    .performance-chart {
        height: 300px;
        background: #f8f9fa;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #666;
        margin: 1rem 0;
    }
</style>
{% endblock %}

{% block content %}
<!-- Analytics Header -->
<div class="analytics-header">
    <div class="container">
        <div class="text-center">
            <h1 class="display-5">üìä Performance Analytics</h1>
            <p class="lead">Compare brand performance and analyze sales data</p>
        </div>
    </div>
</div>

<div class="container">
    <!-- Date Filter -->
    <div class="date-filter">
        <h5>üìÖ Date Range</h5>
        <div class="date-range">
            <label for="start_date">Start Date:</label>
            <input type="date" id="start_date" name="start_date" value="{{ start_date|date:'Y-m-d' }}" class="form-control">
            
            <label for="end_date">End Date:</label>
            <input type="date" id="end_date" name="end_date" value="{{ end_date|date:'Y-m-d' }}" class="form-control">
            
            <button class="btn btn-primary" onclick="filterAnalytics()">
                üîç Filter
            </button>
            
            <button class="btn btn-secondary" onclick="resetDates()">
                üîÑ Reset
            </button>
        </div>
    </div>

    <!-- Brand Performance Overview -->
    <div class="analytics-card">
        <h3>üè¢ Brand Performance Overview</h3>
        
        {% for brand_data in brand_performance %}
            <div class="brand-performance">
                <div class="brand-name">{{ brand_data.brand.name }}</div>
                <div class="brand-stats">
                    <div class="stat-item">
                        <div class="stat-number">{{ brand_data.total_orders }}</div>
                        <div class="stat-label">Orders</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${{ brand_data.total_revenue|floatformat:0 }}</div>
                        <div class="stat-label">Revenue</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${{ brand_data.avg_order_value|floatformat:0 }}</div>
                        <div class="stat-label">Avg Order</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ brand_data.avg_rating|floatformat:1|default:"-" }}</div>
                        <div class="stat-label">Rating</div>
                    </div>
                </div>
            </div>
        {% empty %}
            <p class="text-muted">No performance data available for the selected date range.</p>
        {% endfor %}
        
        <!-- Performance Chart -->
        <div class="performance-chart">
            <div>
                <h5>üìà Revenue Trend</h5>
                <p>Chart visualization would be implemented here</p>
                <small>Integration with Chart.js or similar library</small>
            </div>
        </div>
    </div>

    <!-- Top Performing Items -->
    <div class="analytics-card">
        <h3>üîù Top Performing Items</h3>
        
        {% if top_items %}
            <table class="top-items-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Brand</th>
                        <th>Item</th>
                        <th>Orders</th>
                        <th>Revenue</th>
                        <th>Performance</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in top_items %}
                        <tr>
                            <td><strong>#{{ forloop.counter }}</strong></td>
                            <td>{{ item.brand }}</td>
                            <td>{{ item.item_name }}</td>
                            <td>{{ item.order_count }}</td>
                            <td>${{ item.revenue|floatformat:2 }}</td>
                            <td>
                                <div class="progress" style="height: 20px;">
                                    <div class="progress-bar bg-success" style="width: {{ item.revenue|div:top_items.0.revenue|mul:100|floatformat:0 }}%">
                                        {{ item.revenue|div:top_items.0.revenue|mul:100|floatformat:0 }}%
                                    </div>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="text-muted">No top items data available for the selected date range.</p>
        {% endif %}
    </div>

    <!-- Key Metrics -->
    <div class="row">
        <div class="col-md-4">
            <div class="analytics-card">
                <h4>üìà Total Revenue</h4>
                <div class="stat-number">${{ brand_performance|sum:'total_revenue'|floatformat:0 }}</div>
                <p class="text-muted">Across all brands</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="analytics-card">
                <h4>üì¶ Total Orders</h4>
                <div class="stat-number">{{ brand_performance|sum:'total_orders' }}</div>
                <p class="text-muted">Across all brands</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="analytics-card">
                <h4>üí∞ Average Order Value</h4>
                <div class="stat-number">${{ brand_performance|average:'avg_order_value'|floatformat:0 }}</div>
                <p class="text-muted">Across all brands</p>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="row mt-4">
        <div class="col-md-4">
            <a href="{% url 'menu_management:multi_brand' %}" class="btn btn-secondary w-100">
                ‚Üê Back to Multi-Brand
            </a>
        </div>
        <div class="col-md-4">
            <button class="btn btn-primary w-100" onclick="exportAnalytics()">
                üìä Export Report
            </button>
        </div>
        <div class="col-md-4">
            <button class="btn btn-success w-100" onclick="generateInsights()">
                üí° Generate Insights
            </button>
        </div>
    </div>
</div>

<script>
function filterAnalytics() {
    const startDate = document.getElementById('start_date').value;
    const endDate = document.getElementById('end_date').value;
    
    if (startDate && endDate) {
        window.location.href = `?start_date=${startDate}&end_date=${endDate}`;
    }
}

function resetDates() {
    window.location.href = window.location.pathname;
}

function exportAnalytics() {
    // Mock export functionality
    const startDate = document.getElementById('start_date').value;
    const endDate = document.getElementById('end_date').value;
    
    alert(`Exporting analytics report for ${startDate} to ${endDate}...\n\nIn a real implementation, this would generate a CSV or PDF report with all the performance data.`);
}

function generateInsights() {
    // Mock AI insights generation
    const insights = [
        "üìà Quick Bites Express shows 23% higher order volume on weekends",
        "üí∞ Gourmet Kitchen has the highest average order value at $65.25",
        "üéØ Healthy Harvest performs best during lunch hours (11am-2pm)",
        "üìä Cross-brand ingredient sharing could reduce costs by 8%",
        "üöÄ DoorDash platform shows 15% higher conversion than Uber Eats"
    ];
    
    let insightText = "ü§ñ AI-Generated Insights:\n\n";
    insights.forEach((insight, index) => {
        insightText += `${index + 1}. ${insight}\n`;
    });
    
    alert(insightText);
}

// Template filters for calculations
window.addEventListener('DOMContentLoaded', function() {
    // Add custom template filter functionality
    console.log('Performance analytics loaded');
});
</script>
{% endblock %}
