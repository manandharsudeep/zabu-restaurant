{% extends 'base.html' %}

{% block title %}Course Menu Analytics - Zabu Restaurant{% endblock %}

{% block extra_css %}
<style>
    .analytics-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
    }
    
    .analytics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .analytics-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        border-left: 4px solid #667eea;
    }
    
    .analytics-title {
        font-size: 1.2rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 1rem;
    }
    
    .stat-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
    
    .stat-item {
        text-align: center;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
    }
    
    .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 0.5rem;
    }
    
    .stat-label {
        color: #666;
        font-size: 0.9rem;
    }
    
    .chart-container {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }
    
    .chart-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 1.5rem;
    }
    
    .menu-type-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
        border-bottom: 1px solid #eee;
    }
    
    .menu-type-item:last-child {
        border-bottom: none;
    }
    
    .menu-type-name {
        font-weight: bold;
        color: #333;
    }
    
    .menu-type-stats {
        display: flex;
        gap: 2rem;
        align-items: center;
    }
    
    .menu-type-count {
        background: #667eea;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: bold;
    }
    
    .menu-type-revenue {
        font-weight: bold;
        color: #28a745;
    }
    
    .progress-bar {
        width: 100%;
        height: 8px;
        background: #e9ecef;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 0.5rem;
    }
    
    .progress-fill {
        height: 100%;
        background: #667eea;
        transition: width 0.3s ease;
    }
    
    .back-button {
        display: inline-block;
        padding: 0.75rem 1.5rem;
        background: #667eea;
        color: white;
        text-decoration: none;
        border-radius: 8px;
        font-weight: bold;
        margin-bottom: 2rem;
        transition: all 0.3s ease;
    }
    
    .back-button:hover {
        background: #5a67d8;
        color: white;
        text-decoration: none;
    }
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="analytics-header">
    <div class="container">
        <h1 class="display-4">üìä Course Menu Analytics</h1>
        <p class="lead">Performance insights and trends for your course menu offerings</p>
    </div>
</div>

<div class="container">
    <!-- Back Button -->
    <a href="{% url 'menu_management:enhanced_course_menu_dashboard' %}" class="back-button">
        ‚Üê Back to Course Menu Dashboard
    </a>

    <!-- Overview Stats -->
    <div class="analytics-grid">
        <div class="analytics-card">
            <div class="analytics-title">üìà Menu Performance</div>
            <div class="stat-grid">
                <div class="stat-item">
                    <div class="stat-number">{{ dietary_stats.total }}</div>
                    <div class="stat-label">Total Instances</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ completion_stats.completed }}</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ completion_rate|floatformat:1 }}%</div>
                    <div class="stat-label">Completion Rate</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ completion_stats.cancelled }}</div>
                    <div class="stat-label">Cancelled</div>
                </div>
            </div>
        </div>

        <div class="analytics-card">
            <div class="analytics-title">ü•ó Dietary Preferences</div>
            <div class="stat-grid">
                <div class="stat-item">
                    <div class="stat-number">{{ dietary_stats.vegetarian }}</div>
                    <div class="stat-label">Vegetarian</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ dietary_stats.vegan }}</div>
                    <div class="stat-label">Vegan</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ dietary_stats.gluten_free }}</div>
                    <div class="stat-label">Gluten-Free</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ dietary_stats.no_restrictions }}</div>
                    <div class="stat-label">No Restrictions</div>
                </div>
            </div>
        </div>

        <div class="analytics-card">
            <div class="analytics-title">üí∞ Revenue Insights</div>
            <div class="stat-grid">
                {% for revenue in revenue_by_type %}
                <div class="stat-item">
                    <div class="stat-number">${{ revenue.total_revenue|floatformat:0 }}</div>
                    <div class="stat-label">{{ revenue.template__menu_type|title }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Popular Menu Types -->
    <div class="chart-container">
        <div class="chart-title">üèÜ Popular Menu Types</div>
        {% for menu_type in popular_types %}
        <div class="menu-type-item">
            <div class="menu-type-name">{{ menu_type.template__menu_type|title }}</div>
            <div class="menu-type-stats">
                <div class="menu-type-count">{{ menu_type.count }} instances</div>
                <div class="menu-type-revenue">
                    {% for revenue in revenue_by_type %}
                        {% if revenue.template__menu_type == menu_type.template__menu_type %}
                            ${{ revenue.total_revenue|floatformat:0 }}
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: {{ menu_type.percentage|floatformat:0 }}%"></div>
        </div>
        {% endfor %}
    </div>

    <!-- Completion Rate Analysis -->
    <div class="chart-container">
        <div class="chart-title">‚úÖ Completion Rate Analysis</div>
        <div class="stat-grid">
            <div class="stat-item">
                <div class="stat-number">{{ completion_rate|floatformat:1 }}%</div>
                <div class="stat-label">Overall Completion Rate</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ completion_stats.completed }}</div>
                <div class="stat-label">Successfully Completed</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ completion_stats.cancelled }}</div>
                <div class="stat-label">Cancelled Orders</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ in_progress_count }}</div>
                <div class="stat-label">In Progress</div>
            </div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: {{ completion_rate }}%"></div>
        </div>
    </div>

    <!-- Dietary Trends -->
    <div class="chart-container">
        <div class="chart-title">ü•¨ Dietary Trends</div>
        <div class="stat-grid">
            <div class="stat-item">
                <div class="stat-number">{{ dietary_stats.vegetarian_percentage|floatformat:1 }}%</div>
                <div class="stat-label">Vegetarian Preference</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ dietary_stats.vegan_percentage|floatformat:1 }}%</div>
                <div class="stat-label">Vegan Preference</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ dietary_stats.gluten_free_percentage|floatformat:1 }}%</div>
                <div class="stat-label">Gluten-Free Preference</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ dietary_stats.no_restrictions_percentage|floatformat:1 }}%</div>
                <div class="stat-label">No Restrictions</div>
            </div>
        </div>
    </div>

    <!-- Revenue by Menu Type -->
    <div class="chart-container">
        <div class="chart-title">üí∞ Revenue by Menu Type</div>
        {% for revenue in revenue_by_type %}
        <div class="menu-type-item">
            <div class="menu-type-name">{{ revenue.template__menu_type|title }}</div>
            <div class="menu-type-stats">
                <div class="menu-type-count">${{ revenue.total_revenue|floatformat:0 }}</div>
                <div class="menu-type-revenue">Avg: ${{ revenue.avg_price|floatformat:0 }}/person</div>
            </div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: {{ revenue.revenue_percentage|floatformat:0 }}%"></div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
