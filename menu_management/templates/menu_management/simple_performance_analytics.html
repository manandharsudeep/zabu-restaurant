{% extends 'base.html' %}

{% block title %}Performance Analytics - Zabu Restaurant{% endblock %}

{% block extra_css %}
<style>
    .analytics-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 3rem 0;
        margin-bottom: 2rem;
    }
    
    .analytics-card {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
        transition: all 0.3s ease;
        border-left: 4px solid #667eea;
    }
    
    .analytics-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 15px;
        text-align: center;
    }
    
    .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
    }
    
    .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
    }
    
    .brand-performance {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        border-left: 4px solid #667eea;
        transition: all 0.3s ease;
    }
    
    .brand-performance:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .performance-metric {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }
    
    .metric-label {
        font-weight: 600;
        color: #333;
    }
    
    .metric-value {
        font-weight: bold;
        color: #667eea;
    }
    
    .progress-bar {
        background: #e9ecef;
        border-radius: 10px;
        height: 8px;
        overflow: hidden;
        margin-top: 0.5rem;
    }
    
    .progress-fill {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        height: 100%;
        border-radius: 10px;
        transition: width 0.3s ease;
    }
    
    .chart-container {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid #e9ecef;
    }
    
    .chart-placeholder {
        height: 300px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6c757d;
        font-weight: 600;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 0.75rem 2rem;
        font-weight: 600;
        border-radius: 50px;
        transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
        background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        transform: translateY(-2px);
        color: white;
    }
    
    .btn-secondary {
        background: #6c757d;
        border: none;
        color: white;
        padding: 0.75rem 2rem;
        font-weight: 600;
        border-radius: 50px;
        transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
        color: white;
    }
    
    .trend-up {
        color: #28a745;
    }
    
    .trend-down {
        color: #dc3545;
    }
    
    .trend-neutral {
        color: #ffc107;
    }
    
    .date-filter {
        background: white;
        border-radius: 10px;
        padding: 1rem;
        margin-bottom: 2rem;
        border: 1px solid #e9ecef;
    }
    
    .filter-buttons {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
    
    .filter-btn {
        padding: 0.5rem 1rem;
        border: 1px solid #e9ecef;
        background: white;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .filter-btn:hover {
        background: #f8f9fa;
        border-color: #667eea;
    }
    
    .filter-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
    }
</style>
{% endblock %}

{% block content %}
<!-- Performance Analytics Header -->
<div class="analytics-header">
    <div class="container">
        <div class="text-center">
            <h1 class="display-5">üìä Performance Analytics</h1>
            <p class="lead">Comprehensive insights into your multi-brand performance</p>
        </div>
    </div>
</div>

<div class="container">
    <!-- Date Filter -->
    <div class="date-filter">
        <h5>üìÖ Time Period</h5>
        <div class="filter-buttons">
            <button class="filter-btn" onclick="filterByPeriod('today')">Today</button>
            <button class="filter-btn" onclick="filterByPeriod('week')">This Week</button>
            <button class="filter-btn active" onclick="filterByPeriod('month')">This Month</button>
            <button class="filter-btn" onclick="filterByPeriod('quarter')">This Quarter</button>
            <button class="filter-btn" onclick="filterByPeriod('year')">This Year</button>
            <button class="filter-btn" onclick="filterByPeriod('custom')">Custom Range</button>
        </div>
    </div>

    <!-- Overall Performance Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number">{{ total_revenue|floatformat:0 }}</div>
            <div class="stat-label">Total Revenue ($)</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ total_orders|floatformat:0 }}</div>
            <div class="stat-label">Total Orders</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ avg_order_value|floatformat:2 }}</div>
            <div class="stat-label">Avg Order Value ($)</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ total_customers|floatformat:0 }}</div>
            <div class="stat-label">Total Customers</div>
        </div>
    </div>

    <!-- Revenue Chart -->
    <div class="analytics-card">
        <h3>üí∞ Revenue Trends</h3>
        <div class="chart-container">
            <div class="chart-placeholder">
                üìà Revenue Chart - Last 30 Days Trend
            </div>
        </div>
    </div>

    <!-- Brand Performance Comparison -->
    <div class="analytics-card">
        <h3>üè¢ Brand Performance Comparison</h3>
        
        {% for brand in brand_performance %}
            <div class="brand-performance">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <h5>{{ brand.name }}</h5>
                        <span class="badge bg-primary">{{ brand.menu_type }}</span>
                    </div>
                    <div class="text-end">
                        <div class="metric-value">${{ brand.total_revenue|floatformat:0 }}</div>
                        <small class="text-muted">Revenue</small>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="performance-metric">
                            <span class="metric-label">Orders</span>
                            <span class="metric-value">{{ brand.total_orders }}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ brand.orders_percentage }}%"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="performance-metric">
                            <span class="metric-label">Avg Order Value</span>
                            <span class="metric-value">${{ brand.avg_order_value|floatformat:2 }}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ brand.aov_percentage }}%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-4">
                        <div class="performance-metric">
                            <span class="metric-label">Growth</span>
                            <span class="metric-value {{ brand.growth_trend }}">
                                {{ brand.growth_rate }}%
                            </span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="performance-metric">
                            <span class="metric-label">Profit Margin</span>
                            <span class="metric-value">{{ brand.profit_margin }}%</span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="performance-metric">
                            <span class="metric-label">Rating</span>
                            <span class="metric-value">‚≠ê {{ brand.rating }}</span>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- Top Performing Items -->
    <div class="analytics-card">
        <h3>üçΩÔ∏è Top Performing Menu Items</h3>
        
        <div class="row">
            <div class="col-md-6">
                <h5>By Revenue</h5>
                {% for item in top_revenue_items %}
                    <div class="performance-metric">
                        <span class="metric-label">{{ item.name }}</span>
                        <span class="metric-value">${{ item.revenue|floatformat:0 }}</span>
                    </div>
                {% endfor %}
            </div>
            <div class="col-md-6">
                <h5>By Popularity</h5>
                {% for item in top_popular_items %}
                    <div class="performance-metric">
                        <span class="metric-label">{{ item.name }}</span>
                        <span class="metric-value">{{ item.orders }} orders</span>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Customer Analytics -->
    <div class="analytics-card">
        <h3>üë• Customer Analytics</h3>
        
        <div class="row">
            <div class="col-md-4">
                <div class="performance-metric">
                    <span class="metric-label">New Customers</span>
                    <span class="metric-value trend-up">+{{ new_customers }}</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ new_customers_percentage }}%"></div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="performance-metric">
                    <span class="metric-label">Returning Customers</span>
                    <span class="metric-value trend-up">{{ returning_customers }}</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ returning_customers_percentage }}%"></div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="performance-metric">
                    <span class="metric-label">Customer Retention</span>
                    <span class="metric-value">{{ retention_rate }}%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ retention_rate }}%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Platform Performance -->
    <div class="analytics-card">
        <h3>üì± Platform Performance</h3>
        
        <div class="row">
            <div class="col-md-4">
                <h6>Uber Eats</h6>
                <div class="performance-metric">
                    <span class="metric-label">Orders</span>
                    <span class="metric-value">{{ platform_performance.uber_eats.orders }}</span>
                </div>
                <div class="performance-metric">
                    <span class="metric-label">Revenue</span>
                    <span class="metric-value">${{ platform_performance.uber_eats.revenue|floatformat:0 }}</span>
                </div>
                <div class="performance-metric">
                    <span class="metric-label">Commission</span>
                    <span class="metric-value">{{ platform_performance.uber_eats.commission }}%</span>
                </div>
            </div>
            <div class="col-md-4">
                <h6>DoorDash</h6>
                <div class="performance-metric">
                    <span class="metric-label">Orders</span>
                    <span class="metric-value">{{ platform_performance.doordash.orders }}</span>
                </div>
                <div class="performance-metric">
                    <span class="metric-label">Revenue</span>
                    <span class="metric-value">${{ platform_performance.doordash.revenue|floatformat:0 }}</span>
                </div>
                <div class="performance-metric">
                    <span class="metric-label">Commission</span>
                    <span class="metric-value">{{ platform_performance.doordash.commission }}%</span>
                </div>
            </div>
            <div class="col-md-4">
                <h6>Grubhub</h6>
                <div class="performance-metric">
                    <span class="metric-label">Orders</span>
                    <span class="metric-value">{{ platform_performance.grubhub.orders }}</span>
                </div>
                <div class="performance-metric">
                    <span class="metric-label">Revenue</span>
                    <span class="metric-value">${{ platform_performance.grubhub.revenue|floatformat:0 }}</span>
                </div>
                <div class="performance-metric">
                    <span class="metric-label">Commission</span>
                    <span class="metric-value">{{ platform_performance.grubhub.commission }}%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="row mt-4">
        <div class="col-md-3">
            <a href="{% url 'menu_management:multi_brand' %}" class="btn btn-secondary w-100">
                ‚Üê Back to Multi-Brand
            </a>
        </div>
        <div class="col-md-3">
            <button class="btn btn-primary w-100" onclick="exportReport()">
                üìä Export Report
            </button>
        </div>
        <div class="col-md-3">
            <button class="btn btn-primary w-100" onclick="generateInsights()">
                ü§ñ Generate AI Insights
            </button>
        </div>
        <div class="col-md-3">
            <button class="btn btn-primary w-100" onclick="scheduleReport()">
                üìÖ Schedule Reports
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function filterByPeriod(period) {
    // Remove active class from all buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Add active class to clicked button
    event.target.classList.add('active');
    
    // Show loading message
    alert('üìä Loading analytics data for: ' + period.charAt(0).toUpperCase() + period.slice(1) + '\n\nThis would:\n‚Ä¢ Update all metrics\n‚Ä¢ Refresh charts\n‚Ä¢ Reload brand performance\n‚Ä¢ Recalculate trends');
    
    // In a real implementation, this would make an AJAX call to update the data
    console.log('Filtering by period:', period);
}

function exportReport() {
    alert('üìä Generating comprehensive analytics report...\n\nReport includes:\n‚Ä¢ Revenue trends\n‚Ä¢ Brand performance\n‚Ä¢ Customer analytics\n‚Ä¢ Platform breakdown\n‚Ä¢ Top performing items\n‚Ä¢ Growth metrics\n\nFormat: PDF + Excel\nDelivery: Email + Download');
}

function generateInsights() {
    alert('ü§ñ Generating AI-powered insights...\n\nAnalyzing:\n‚Ä¢ Performance patterns\n‚Ä¢ Growth opportunities\n‚Ä¢ Optimization suggestions\n‚Ä¢ Customer behavior\n‚Ä¢ Market trends\n\nThis may take 2-3 minutes...');
    
    setTimeout(() => {
        alert('‚úÖ AI Insights Generated!\n\nKey Findings:\n‚Ä¢ Revenue up 15% vs last month\n‚Ä¢ Uber Eats performing 20% better\n‚Ä¢ Customer retention improved to 68%\n‚Ä¢ 3 items need price optimization\n‚Ä¢ Peak hours: 12-2pm, 6-8pm');
    }, 2000);
}

function scheduleReport() {
    const schedule = prompt('üìÖ Schedule automated reports\n\nEnter frequency:\n‚Ä¢ daily\n‚Ä¢ weekly\n‚Ä¢ monthly\n‚Ä¢ quarterly', 'weekly');
    
    if (schedule) {
        alert('‚úÖ Reports scheduled: ' + schedule + '\n\nYou will receive:\n‚Ä¢ Performance summaries\n‚Ä¢ Trend analysis\n‚Ä¢ Key insights\n‚Ä¢ Recommendations\n\nDelivery: Email dashboard');
    }
}

// Simulate real-time updates
setInterval(() => {
    // Update a random metric to show real-time capability
    const metrics = document.querySelectorAll('.metric-value');
    if (metrics.length > 0) {
        const randomMetric = metrics[Math.floor(Math.random() * metrics.length)];
        const currentValue = parseFloat(randomMetric.textContent.replace(/[^0-9.-]/g, ''));
        const change = (Math.random() - 0.5) * 2; // Random change between -1 and 1
        const newValue = (currentValue + change).toFixed(2);
        
        // Add animation effect
        randomMetric.style.color = '#28a745';
        setTimeout(() => {
            randomMetric.style.color = '';
        }, 1000);
    }
}, 10000); // Update every 10 seconds
</script>
{% endblock %}
