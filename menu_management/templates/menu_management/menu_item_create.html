{% extends 'base.html' %}

{% block title %}Add Section to {{ menu_section.menu.name }} - Zabu Restaurant{% endblock %}

{% block extra_css %}
<style>
    .form-section {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }
    
    .form-header {
        border-bottom: 1px solid #eee;
        padding-bottom: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        font-weight: 600;
        color: #333;
        margin-bottom: 0.5rem;
    }
    
    .form-control, .form-select {
        border-radius: 10px;
        border: 2px solid #e9ecef;
        padding: 0.75rem 1rem;
        transition: all 0.3s ease;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 0.75rem 2rem;
        font-weight: 600;
        border-radius: 50px;
        transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
        background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        transform: translateY(-2px);
        color: white;
    }
    
    .btn-secondary {
        background: #6c757d;
        border: none;
        color: white;
        padding: 0.75rem 2rem;
        font-weight: 600;
        border-radius: 50px;
        transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
        color: white;
    }
    
    .menu-info {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 15px;
        margin-bottom: 2rem;
    }
    
    .menu-info h3 {
        margin-bottom: 0.5rem;
    }
    
    .menu-info p {
        margin-bottom: 0;
        opacity: 0.9;
    }
    
    .help-text {
        font-size: 0.875rem;
        color: #6c757d;
        margin-top: 0.25rem;
    }
    
    .recipe-preview {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1rem;
        margin-bottom: 1rem;
        border-left: 4px solid #667eea;
    }
    
    .recipe-preview h6 {
        color: #333;
        margin-bottom: 0.5rem;
    }
    
    .recipe-preview p {
        color: #666;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
    }
    
    .recipe-preview .meta {
        font-size: 0.8rem;
        color: #999;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="display-5">‚ûï Add Menu Item</h1>
            <p class="text-muted">Add a new item to {{ menu_section.menu.name }}</p>
        </div>
        <div class="col-md-4 text-end">
            <a href="{% url 'menu_management:menu_detail' menu_section.menu.id %}" class="btn btn-secondary btn-lg">
                ‚Üê Back to Menu
            </a>
        </div>
    </div>

    <!-- Menu Info -->
    <div class="menu-info">
        <h3>üìã {{ menu_section.menu.name }}</h3>
        <p>Section: {{ menu_section.name }} | Type: {{ menu_section.menu.get_menu_type_display }}</p>
    </div>

    <!-- Form -->
    <div class="form-section">
        <form method="post">
            {% csrf_token %}
            
            <!-- Recipe Selection -->
            <div class="form-header">
                <h3>üçΩÔ∏è Recipe Selection</h3>
            </div>
            
            <div class="form-group">
                <label for="recipe" class="form-label">Select Recipe *</label>
                <select class="form-select" id="recipe" name="recipe" required>
                    <option value="">Choose a recipe...</option>
                    {% for recipe in recipes %}
                        <option value="{{ recipe.id }}" {% if recipe.id == menu_item.recipe.id %}selected{% endif %}>
                            {{ recipe.name }} - ${{ recipe.cost_per_portion|floatformat:2 }}/portion
                        </option>
                    {% endfor %}
                </select>
                <small class="help-text">Select a recipe to base this menu item on</small>
            </div>
            
            <!-- Item Details -->
            <div class="form-header">
                <h3>üìù Item Details</h3>
            </div>
            
            <div class="form-group">
                <label for="name" class="form-label">Display Name *</label>
                <input type="text" class="form-control" id="name" name="name" required
                       placeholder="e.g., Grilled Salmon with Lemon Butter">
                <small class="help-text">This is what customers will see on the menu</small>
            </div>
            
            <div class="form-group">
                <label for="description" class="form-label">Description *</label>
                <textarea class="form-control" id="description" name="description" rows="3" required
                          placeholder="Describe the dish, ingredients, preparation style, etc."></textarea>
                <small class="help-text">Appealing description for customers</small>
            </div>
            
            <div class="form-group">
                <label for="price" class="form-label">Price ($) *</label>
                <input type="number" class="form-control" id="price" name="price" step="0.01" min="0" required
                       placeholder="e.g., 24.99">
                <small class="help-text">Selling price for this menu item</small>
            </div>
            
            <div class="form-group">
                <label for="prep_time" class="form-label">Preparation Time (minutes)</label>
                <input type="number" class="form-control" id="prep_time" name="prep_time" min="0"
                       placeholder="e.g., 15">
                <small class="help-text">Optional: Time needed to prepare this item</small>
            </div>
            
            <!-- Additional Details -->
            <div class="form-header">
                <h3>‚öôÔ∏è Additional Details</h3>
            </div>
            
            <div class="form-group">
                <label for="plating_instructions" class="form-label">Plating Instructions</label>
                <textarea class="form-control" id="plating_instructions" name="plating_instructions" rows="2"
                          placeholder="e.g., Serve on white plate, garnish with fresh herbs"></textarea>
                <small class="help-text">Optional: Instructions for kitchen staff on presentation</small>
            </div>
            
            <div class="form-group">
                <label for="chef_notes" class="form-label">Chef's Notes</label>
                <textarea class="form-control" id="chef_notes" name="chef_notes" rows="2"
                          placeholder="e.g., Ask about spice preference, can be made gluten-free"></textarea>
                <small class="help-text">Optional: Special notes for kitchen staff</small>
            </div>
            
            <!-- Dietary Information -->
            <div class="form-header">
                <h3>ü•ó Dietary Information</h3>
            </div>
            
            <div class="form-group">
                <label class="form-label">Dietary Options</label>
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="dietary_vegetarian" id="dietary_vegetarian">
                            <label class="form-check-label" for="dietary_vegetarian">
                                ü•¨ Vegetarian
                            </label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="dietary_vegan" id="dietary_vegan">
                            <label class="form-check-label" for="dietary_vegan">
                                üå± Vegan
                            </label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="dietary_gluten_free" id="dietary_gluten_free">
                                <label class="form-check-label" for="dietary_gluten_free">
                                üåæ Gluten-Free
                            </label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="dietary_dairy_free" id="dietary_dairy_free">
                                <label class="form-check-label" for="dietary_dairy_free">
                                ü•õ Dairy-Free
                            </label>
                        </div>
                    </div>
                </div>
                <small class="help-text">Select all applicable dietary options</small>
            </div>
            
            <!-- Form Actions -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <button type="submit" class="btn btn-primary w-100">
                        ‚ûï Add Menu Item
                    </button>
                </div>
                <div class="col-md-6">
                    <a href="{% url 'menu_management:menu_detail' menu_section.menu.id %}" class="btn btn-secondary w-100">
                        ‚ùå Cancel
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const recipeSelect = document.getElementById('recipe');
    const nameInput = document.getElementById('name');
    const priceInput = document.getElementById('price');
    const prepTimeInput = document.getElementById('prep_time');
    
    // Auto-fill form when recipe is selected
    recipeSelect.addEventListener('change', function() {
        const selectedOption = this.options[this.selectedIndex];
        const recipeName = selectedOption.text.split(' - ')[0];
        
        if (this.value) {
            // Auto-fill name with recipe name
            nameInput.value = recipeName;
            
            // Auto-fill price with markup (cost * 3)
            const costText = selectedOption.text.split('$')[1].split('/')[0];
            const cost = parseFloat(costText);
            if (!isNaN(cost)) {
                priceInput.value = (cost * 3).toFixed(2);
            }
        }
    });
    
    // Validate form before submission
    document.querySelector('form').addEventListener('submit', function(e) {
        const price = parseFloat(priceInput.value);
        const prepTime = parseInt(prepTimeInput.value);
        
        if (price <= 0) {
            e.preventDefault();
            alert('Price must be greater than 0');
            return false;
        }
        
        if (prepTime < 0) {
            e.preventDefault();
            alert('Preparation time cannot be negative');
            return false;
        }
        
        return true;
    });
});
</script>
{% endblock %}
